{"version":3,"file":"leaflet-elevation.js","sources":["../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/leaflet-elevation.js"],"sourcesContent":["// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","/*\r\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\r\n *\r\n *  This file is free software: you may copy, redistribute and/or modify it\r\n *  under the terms of the GNU General Public License as published by the\r\n *  Free Software Foundation, either version 2 of the License, or (at your\r\n *  option) any later version.\r\n *\r\n *  This file is distributed in the hope that it will be useful, but\r\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\r\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n *  General Public License for more details.\r\n *\r\n *  You should have received a copy of the GNU General Public License\r\n *  along with this program.  If not, see .\r\n *\r\n * This file incorporates work covered by the following copyright and\r\n * permission notice:\r\n *\r\n *     Copyright (c) 2013-2016, MIT License, Felix “MrMufflon” Bache\r\n *\r\n *     Permission to use, copy, modify, and/or distribute this software\r\n *     for any purpose with or without fee is hereby granted, provided\r\n *     that the above copyright notice and this permission notice appear\r\n *     in all copies.\r\n *\r\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\r\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\r\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\r\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\r\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\r\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\r\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n */\r\n\r\nimport 'leaflet-i18n';\r\n\r\nL.Control.Elevation = L.Control.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tautohide: true,\r\n\t\tautohideMarker: true,\r\n\t\tcollapsed: false,\r\n\t\tcontrolButton: {\r\n\t\t\ticonCssClass: \"elevation-toggle-icon\",\r\n\t\t\ttitle: \"Elevation\"\r\n\t\t},\r\n\t\tdetached: true,\r\n\t\tdistanceFactor: 1,\r\n\t\tdownloadLink: 'link',\r\n\t\televationDiv: \"#elevation-div\",\r\n\t\tfollowMarker: true,\r\n\t\tforceAxisBounds: false,\r\n\t\tgpxOptions: {\r\n\t\t\tasync: true,\r\n\t\t\tmarker_options: {\r\n\t\t\t\tstartIconUrl: null,\r\n\t\t\t\tendIconUrl: null,\r\n\t\t\t\tshadowUrl: null,\r\n\t\t\t\twptIcons: {\r\n\t\t\t\t\t'': L.divIcon({\r\n\t\t\t\t\t\tclassName: 'elevation-waypoint-marker',\r\n\t\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\r\n\t\t\t\t\t\ticonSize: [30, 30],\r\n\t\t\t\t\t\ticonAnchor: [8, 30],\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tpolyline_options: {\r\n\t\t\t\tclassName: '',\r\n\t\t\t\tcolor: '#566B13',\r\n\t\t\t\topacity: 0.75,\r\n\t\t\t\tweight: 5,\r\n\t\t\t\tlineCap: 'round'\r\n\t\t\t},\r\n\t\t},\r\n\t\theight: 200,\r\n\t\theightFactor: 1,\r\n\t\thoverNumber: {\r\n\t\t\tdecimalsX: 2,\r\n\t\t\tdecimalsY: 0,\r\n\t\t\tformatter: undefined\r\n\t\t},\r\n\t\timperial: false,\r\n\t\tinterpolation: \"curveLinear\",\r\n\t\tlazyLoadJS: true,\r\n\t\tlegend: true,\r\n\t\tloadData: {\r\n\t\t\tdefer: false,\r\n\t\t\tlazy: false,\r\n\t\t},\r\n\t\tmarker: 'elevation-line',\r\n\t\tmarkerIcon: L.divIcon({\r\n\t\t\tclassName: 'elevation-position-marker',\r\n\t\t\thtml: '<i class=\"elevation-position-icon\"></i>',\r\n\t\t\ticonSize: [32, 32],\r\n\t\t\ticonAnchor: [16, 16],\r\n\t\t}),\r\n\t\tplaceholder: false,\r\n\t\tposition: \"topright\",\r\n\t\treverseCoords: false,\r\n\t\tskipNullZCoords: false,\r\n\t\ttheme: \"lightblue-theme\",\r\n\t\tmargins: {\r\n\t\t\ttop: 10,\r\n\t\t\tright: 20,\r\n\t\t\tbottom: 30,\r\n\t\t\tleft: 50\r\n\t\t},\r\n\t\tresponsive: true,\r\n\t\tsummary: 'inline',\r\n\t\twidth: 600,\r\n\t\txLabel: \"km\",\r\n\t\txTicks: undefined,\r\n\t\tyAxisMax: undefined,\r\n\t\tyAxisMin: undefined,\r\n\t\tyLabel: \"m\",\r\n\t\tyTicks: undefined,\r\n\t\tzFollow: 13,\r\n\t},\r\n\t__mileFactor: 0.621371,\r\n\t__footFactor: 3.28084,\r\n\r\n\t/*\r\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\r\n\t */\r\n\taddData: function(d, layer) {\r\n\t\tthis._addData(d);\r\n\r\n\t\tif (this._container) {\r\n\t\t\tthis._applyData();\r\n\t\t}\r\n\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\r\n\t\t\tlayer = d;\r\n\t\t}\r\n\t\tif (layer) {\r\n\t\t\tif (layer._path) {\r\n\t\t\t\tL.DomUtil.addClass(layer._path, 'elevation-polyline ' + this.options.theme);\r\n\t\t\t}\r\n\t\t\tlayer\r\n\t\t\t\t.on(\"mousemove\", this._mousemoveLayerHandler, this)\r\n\t\t\t\t.on(\"mouseout\", this._mouseoutHandler, this);\r\n\t\t}\r\n\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance;\r\n\t\tthis.track_info.elevation_max = this._maxElevation;\r\n\t\tthis.track_info.elevation_min = this._minElevation;\r\n\r\n\t\tthis._layers = this._layers || {};\r\n\t\tthis._layers[L.Util.stamp(layer)] = layer;\r\n\r\n\t\tvar evt = {\r\n\t\t\tdata: d,\r\n\t\t\tlayer: layer,\r\n\t\t\ttrack_info: this.track_info,\r\n\t\t};\r\n\t\tif (this.fire) this.fire(\"eledata_added\", evt, true);\r\n\t\tif (this._map) this._map.fire(\"eledata_added\", evt, true);\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given map.\r\n\t */\r\n\taddTo: function(map) {\r\n\t\tif (this.options.detached) {\r\n\t\t\tthis._addToChartDiv(map);\r\n\t\t} else {\r\n\t\t\tL.Control.prototype.addTo.call(this, map);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data and display\r\n\t */\r\n\tclear: function() {\r\n\r\n\t\tthis._clearPath();\r\n\t\tthis._clearChart();\r\n\t\tthis._clearData();\r\n\r\n\t\tif (this.fire) this.fire(\"eledata_clear\");\r\n\t\tif (this._map) this._map.fire(\"eledata_clear\");\r\n\t},\r\n\r\n\t/**\r\n\t * Disable dragging chart on touch events.\r\n\t */\r\n\tdisableDragging: function() {\r\n\t\tthis._draggingEnabled = false;\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable dragging chart on touch events.\r\n\t */\r\n\tenableDragging: function() {\r\n\t\tthis._draggingEnabled = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a map view that contains the given geographical bounds.\r\n\t */\r\n\tfitBounds: function(bounds) {\r\n\t\tbounds = bounds || this._fullExtent;\r\n\t\tif (this._map && bounds) this._map.fitBounds(bounds);\r\n\t},\r\n\r\n\t/**\r\n\t * Get default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tgetZFollow: function() {\r\n\t\treturn this._zFollow;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\thide: function() {\r\n\t\tthis._container.style.display = \"none\";\r\n\t},\r\n\r\n\t/**\r\n\t * Initialize chart control \"options\" and \"container\".\r\n\t */\r\n\tinitialize: function(options) {\r\n\t\tthis.options.autohide = typeof options.autohide !== \"undefined\" ? options.autohide : !L.Browser.mobile;\r\n\r\n\t\t// Aliases.\r\n\t\tif (typeof options.detachedView !== \"undefined\") this.options.detached = options.detachedView;\r\n\t\tif (typeof options.responsiveView !== \"undefined\") this.options.responsive = options.responsiveView;\r\n\t\tif (typeof options.showTrackInfo !== \"undefined\") this.options.summary = options.showTrackInfo;\r\n\t\tif (typeof options.summaryType !== \"undefined\") this.options.summary = options.summaryType;\r\n\t\tif (typeof options.autohidePositionMarker !== \"undefined\") this.options.autohideMarker = options.autohidePositionMarker;\r\n\t\tif (typeof options.followPositionMarker !== \"undefined\") this.options.followMarker = options.followPositionMarker;\r\n\t\tif (typeof options.useLeafletMarker !== \"undefined\") this.options.marker = options.useLeafletMarker ? 'position-marker' : 'elevation-line';\r\n\t\tif (typeof options.leafletMarkerIcon !== \"undefined\") this.options.markerIcon = options.leafletMarkerIcon;\r\n\t\tif (typeof options.download !== \"undefined\") this.options.downloadLink = options.download;\r\n\r\n\t\t// L.Util.setOptions(this, options);\r\n\t\tthis.options = this._deepMerge({}, this.options, options);\r\n\r\n\t\tthis._draggingEnabled = !L.Browser.mobile;\r\n\t\tthis._chartEnabled = true;\r\n\r\n\t\tif (options.imperial) {\r\n\t\t\tthis._distanceFactor = this.__mileFactor;\r\n\t\t\tthis._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\tthis._distanceFactor = this.options.distanceFactor;\r\n\t\t\tthis._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._zFollow = this.options.zFollow;\r\n\r\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\r\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for loadData\r\n\t */\r\n\tload: function(data, opts) {\r\n\t\tthis.loadData(data, opts);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for addTo\r\n\t */\r\n\tloadChart: function(map) {\r\n\t\tthis.addTo(map);\r\n\t},\r\n\r\n\t/**\r\n\t * Load elevation data (GPX or GeoJSON).\r\n\t */\r\n\tloadData: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tif (opts.defer) {\r\n\t\t\tthis.loadDefer(data, opts);\r\n\t\t} else if (opts.lazy) {\r\n\t\t\tthis.loadLazy(data, opts);\r\n\t\t} else if (this._isXMLDoc(data)) {\r\n\t\t\tthis.loadGPX(data);\r\n\t\t} else if (this._isJSONDoc(data)) {\r\n\t\t\tthis.loadGeoJSON(data);\r\n\t\t} else {\r\n\t\t\tthis.loadFile(data);\r\n\t\t}\r\n\t},\r\n\r\n\tloadDefer: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.defer = false;\r\n\t\tif (document.readyState !== 'complete') window.addEventListener(\"load\", L.bind(this.loadData, this, data, opts), { once: true });\r\n\t\telse this.loadData(data, opts)\r\n\t},\r\n\r\n\tloadFile: function(url) {\r\n\t\tthis._downloadURL = url; // TODO: handle multiple urls?\r\n\t\ttry {\r\n\t\t\tvar xhr = new XMLHttpRequest();\r\n\t\t\txhr.responseType = \"text\";\r\n\t\t\txhr.open('GET', url);\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tif (xhr.status !== 200) {\r\n\t\t\t\t\tthrow \"Error \" + xhr.status + \" while fetching remote file: \" + url;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.loadData(xhr.response, { lazy: false, defer: false });\r\n\t\t\t\t}\r\n\t\t\t}.bind(this);\r\n\t\t\txhr.send();\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\t},\r\n\r\n\tloadGeoJSON: function(data) {\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\tdata = JSON.parse(data);\r\n\t\t}\r\n\r\n\t\tthis.layer = this.geojson = L.geoJson(data, {\r\n\t\t\tstyle: function(feature) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcolor: '#566B13',\r\n\t\t\t\t\tclassName: 'elevation-polyline ' + this.options.theme,\r\n\t\t\t\t};\r\n\t\t\t}.bind(this),\r\n\t\t\tonEachFeature: function(feature, layer) {\r\n\t\t\t\tthis.addData(feature, layer);\r\n\r\n\t\t\t\tthis.track_info = this.track_info || {};\r\n\t\t\t\tthis.track_info.type = \"geojson\";\r\n\t\t\t\tthis.track_info.name = data.name;\r\n\t\t\t\tthis.track_info.distance = this._distance;\r\n\t\t\t\tthis.track_info.elevation_max = this._maxElevation;\r\n\t\t\t\tthis.track_info.elevation_min = this._minElevation;\r\n\r\n\t\t\t}.bind(this),\r\n\t\t});\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.once('layeradd', function(e) {\r\n\t\t\t\tthis.fitBounds(this.layer.getBounds());\r\n\t\t\t\tvar evt = {\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tlayer: this.layer,\r\n\t\t\t\t\tname: this.track_info.name,\r\n\t\t\t\t\ttrack_info: this.track_info,\r\n\t\t\t\t};\r\n\t\t\t\tif (this.fire) this.fire(\"eledata_loaded\", evt, true);\r\n\t\t\t\tif (this._map) this._map.fire(\"eledata_loaded\", evt, true);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.layer.addTo(this._map);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t}\r\n\t},\r\n\r\n\tloadGPX: function(data) {\r\n\t\tvar callback = function(data) {\r\n\t\t\tthis.options.gpxOptions.polyline_options.className += 'elevation-polyline ' + this.options.theme;\r\n\r\n\t\t\tthis.layer = this.gpx = new L.GPX(data, this.options.gpxOptions);\r\n\r\n\t\t\tthis.layer.on('loaded', function(e) {\r\n\t\t\t\tthis.fitBounds(e.target.getBounds());\r\n\t\t\t}, this);\r\n\t\t\tthis.layer.on('addpoint', function(e) {\r\n\t\t\t\tif (e.point._popup) {\r\n\t\t\t\t\te.point._popup.options.className = 'elevation-popup';\r\n\t\t\t\t\te.point._popup._content = decodeURI(e.point._popup._content);\r\n\t\t\t\t}\r\n\t\t\t\tif (e.point._popup && e.point._popup._content) {\r\n\t\t\t\t\te.point.bindTooltip(e.point._popup._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.layer.once(\"addline\", function(e) {\r\n\t\t\t\tthis.addData(e.line /*, this.layer*/ );\r\n\r\n\t\t\t\tthis.track_info = this.track_info || {};\r\n\t\t\t\tthis.track_info.type = \"gpx\";\r\n\t\t\t\tthis.track_info.name = this.layer.get_name();\r\n\t\t\t\tthis.track_info.distance = this._distance;\r\n\t\t\t\tthis.track_info.elevation_max = this._maxElevation;\r\n\t\t\t\tthis.track_info.elevation_min = this._minElevation;\r\n\r\n\t\t\t\tvar evt = {\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tlayer: this.layer,\r\n\t\t\t\t\tname: this.track_info.name,\r\n\t\t\t\t\ttrack_info: this.track_info,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (this.fire) this.fire(\"eledata_loaded\", evt, true);\r\n\t\t\t\tif (this._map) this._map.fire(\"eledata_loaded\", evt, true);\r\n\t\t\t}, this);\r\n\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis.layer.addTo(this._map);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t\t}\r\n\t\t}.bind(this, data);\r\n\t\tif (typeof L.GPX !== 'function' && this.options.lazyLoadJS) {\r\n\t\t\tL.Control.Elevation._gpxLazyLoader = this._lazyLoadJS('https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.4.0/gpx.js', L.Control.Elevation._gpxLazyLoader);\r\n\t\t\tL.Control.Elevation._gpxLazyLoader.then(callback);\r\n\t\t} else {\r\n\t\t\tcallback.call();\r\n\t\t}\r\n\t},\r\n\r\n\tloadLazy: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.lazy = false;\r\n\t\tlet ticking = false;\r\n\t\tlet scrollFn = L.bind(function(data) {\r\n\t\t\tif (!ticking) {\r\n\t\t\t\tL.Util.requestAnimFrame(function() {\r\n\t\t\t\t\tif (this._isVisible(this.placeholder)) {\r\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\r\n\t\t\t\t\t\tthis.loadData(data, opts);\r\n\t\t\t\t\t\tthis.once('eledata_loaded', function() {\r\n\t\t\t\t\t\t\tif (this.placeholder && this.placeholder.parentNode) {\r\n\t\t\t\t\t\t\t\tthis.placeholder.parentNode.removeChild(this.placeholder);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, this)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tticking = false;\r\n\t\t\t\t}, this);\r\n\t\t\t\tticking = true;\r\n\t\t\t}\r\n\t\t}, this, data);\r\n\t\twindow.addEventListener('scroll', scrollFn);\r\n\t\tif (this.placeholder) this.placeholder.addEventListener('mouseenter', scrollFn, { once: true });\r\n\t\tscrollFn();\r\n\t},\r\n\r\n\tonAdd: function(map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tvar container = this._container = L.DomUtil.create(\"div\", \"elevation-control elevation\");\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-control');\r\n\t\t}\r\n\r\n\t\tif (this.options.theme) {\r\n\t\t\tL.DomUtil.addClass(container, this.options.theme); // append theme to control\r\n\t\t}\r\n\r\n\t\tif (this.options.placeholder && !this._data) {\r\n\t\t\tthis.placeholder = L.DomUtil.create('img', 'elevation-placeholder');\r\n\t\t\tif (typeof this.options.placeholder === 'string') {\r\n\t\t\t\tthis.placeholder.src = this.options.placeholder;\r\n\t\t\t\tthis.placeholder.alt = '';\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i in this.options.placeholder) { this.placeholder.setAttribute(i, this.options.placeholder[i]); }\r\n\t\t\t}\r\n\t\t\tcontainer.insertBefore(this.placeholder, container.firstChild);\r\n\t\t}\r\n\r\n\t\tvar callback = function(map, container) {\r\n\t\t\tthis._initToggle(container);\r\n\t\t\tthis._initChart(container);\r\n\r\n\t\t\tthis._applyData();\r\n\r\n\t\t\tthis._map.on('zoom viewreset zoomanim', this._hidePositionMarker, this);\r\n\t\t\tthis._map.on('resize', this._resetView, this);\r\n\t\t\tthis._map.on('resize', this._resizeChart, this);\r\n\t\t\tthis._map.on('mousedown', this._resetDrag, this);\r\n\r\n\t\t\tthis._map.on('eledata_loaded', this._updateSummary, this);\r\n\r\n\t\t\tL.DomEvent.on(this._map._container, 'mousewheel', this._resetDrag, this);\r\n\t\t\tL.DomEvent.on(this._map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\t}.bind(this, map, container);\r\n\t\tif (typeof d3 !== 'object' && this.options.lazyLoadJS) {\r\n\t\t\tL.Control.Elevation._d3LazyLoader = this._lazyLoadJS('https://unpkg.com/d3@4.13.0/build/d3.min.js', L.Control.Elevation._d3LazyLoader);\r\n\t\t\tL.Control.Elevation._d3LazyLoader.then(callback);\r\n\t\t} else {\r\n\t\t\tcallback.call();\r\n\t\t}\r\n\t\treturn container;\r\n\t},\r\n\r\n\tonRemove: function(map) {\r\n\t\tthis._container = null;\r\n\t},\r\n\r\n\tredraw: function() {\r\n\t\tthis._resizeChart();\r\n\t},\r\n\r\n\tsetZFollow: function(zoom) {\r\n\t\tthis._zFollow = zoom;\r\n\t},\r\n\r\n\tshow: function() {\r\n\t\tthis._container.style.display = \"block\";\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\r\n\t */\r\n\t_addData: function(d) {\r\n\t\tvar geom = d && d.geometry && d.geometry;\r\n\t\tvar i;\r\n\r\n\t\tif (geom) {\r\n\t\t\tswitch (geom.type) {\r\n\t\t\t\tcase 'LineString':\r\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'MultiLineString':\r\n\t\t\t\t\tfor (i = 0; i < geom.coordinates.length; i++) {\r\n\t\t\t\t\t\tthis._addGeoJSONData(geom.coordinates[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar feat = d && d.type === \"FeatureCollection\";\r\n\t\tif (feat) {\r\n\t\t\tfor (i = 0; i < d.features.length; i++) {\r\n\t\t\t\tthis._addData(d.features[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (d && d._latlngs) {\r\n\t\t\tthis._addGPXdata(d._latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\r\n\t */\r\n\t_addGeoJSONData: function(coords) {\r\n\t\tif (coords) {\r\n\t\t\tfor (var i = 0; i < coords.length; i++) {\r\n\t\t\t\tthis._addPoint(coords[i][1], coords[i][0], coords[i][2]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing function for GPX data and their elevation in z-coordinate\r\n\t */\r\n\t_addGPXdata: function(coords) {\r\n\t\tif (coords) {\r\n\t\t\tfor (var i = 0; i < coords.length; i++) {\r\n\t\t\t\tthis._addPoint(coords[i].lat, coords[i].lng, coords[i].meta.ele);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_addPoint: function(x, y, z) {\r\n\t\tif (this.options.reverseCoords) {\r\n\t\t\tvar tmp = x;\r\n\t\t\tx = y;\r\n\t\t\ty = tmp;\r\n\t\t}\r\n\r\n\t\tvar data = this._data || [];\r\n\t\tvar eleMax = this._maxElevation || -Infinity;\r\n\t\tvar eleMin = this._minElevation || +Infinity;\r\n\t\tvar dist = this._distance || 0;\r\n\r\n\t\tvar curr = new L.LatLng(x, y);\r\n\t\tvar prev = data.length ? data[data.length - 1].latlng : curr;\r\n\r\n\t\tvar delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\r\n\r\n\t\t// check and fix missing elevation data on last added point\r\n\t\tif (!this.options.skipNullZCoords && data.length > 0) {\r\n\t\t\tvar prevZ = data[data.length - 1].z;\r\n\t\t\tif (isNaN(prevZ)) {\r\n\t\t\t\tvar lastZ = this._lastValidZ;\r\n\t\t\t\tvar currZ = z * this._heightFactor;\r\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\r\n\t\t\t\t} else if (!isNaN(lastZ)) {\r\n\t\t\t\t\tprevZ = lastZ;\r\n\t\t\t\t} else if (!isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = currZ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(prevZ)) data[data.length - 1].z = prevZ;\r\n\t\t\t\telse data.splice(data.length - 1, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tz = z * this._heightFactor;\r\n\r\n\t\t// skip point if it has not elevation\r\n\t\tif (!isNaN(z)) {\r\n\t\t\teleMax = eleMax < z ? z : eleMax;\r\n\t\t\teleMin = eleMin > z ? z : eleMin;\r\n\t\t\tthis._lastValidZ = z;\r\n\t\t}\r\n\r\n\t\tdata.push({\r\n\t\t\tdist: dist,\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tz: z,\r\n\t\t\tlatlng: curr\r\n\t\t});\r\n\r\n\t\tthis._data = data;\r\n\t\tthis._distance = dist;\r\n\t\tthis._maxElevation = eleMax;\r\n\t\tthis._minElevation = eleMin;\r\n\t},\r\n\r\n\t_addToChartDiv: function(map) {\r\n\t\tthis._appendElevationDiv(map._container).appendChild(this.onAdd(map));\r\n\t},\r\n\r\n\t_appendChart: function(svg) {\r\n\t\tvar g = svg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", \"translate(\" + this.options.margins.left + \",\" + this.options.margins.top + \")\");\r\n\r\n\t\tthis._appendGrid(g);\r\n\t\tthis._appendAreaPath(g);\r\n\t\tthis._appendAxis(g);\r\n\t\tthis._appendFocusRect(g);\r\n\t\tthis._appendMouseFocusG(g);\r\n\t\tthis._appendLegend(g);\r\n\t},\r\n\r\n\t_appendElevationDiv: function(container) {\r\n\t\tvar eleDiv = document.querySelector(this.options.elevationDiv);\r\n\t\tif (!eleDiv) {\r\n\t\t\teleDiv = L.DomUtil.create('div', 'leaflet-control elevation elevation-div');\r\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + Math.random().toString(36).substr(2, 9);\r\n\t\t\teleDiv.id = this.options.elevationDiv.substr(1);\r\n\t\t\tcontainer.parentNode.insertBefore(eleDiv, container.nextSibling); // insert after end of container.\r\n\t\t}\r\n\t\tif (this.options.detached) {\r\n\t\t\tL.DomUtil.addClass(eleDiv, 'elevation-detached');\r\n\t\t\tL.DomUtil.removeClass(eleDiv, 'leaflet-control');\r\n\t\t}\r\n\t\tthis.eleDiv = eleDiv;\r\n\t\treturn this.eleDiv;\r\n\t},\r\n\r\n\t_appendXaxis: function(axis) {\r\n\t\taxis\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"class\", \"x axis\")\r\n\t\t\t.attr(\"transform\", \"translate(0,\" + this._height() + \")\")\r\n\t\t\t.call(\r\n\t\t\t\td3\r\n\t\t\t\t.axisBottom()\r\n\t\t\t\t.scale(this._x)\r\n\t\t\t\t.ticks(this.options.xTicks)\r\n\t\t\t)\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"x\", this._width() + 6)\r\n\t\t\t.attr(\"y\", 30)\r\n\t\t\t.text(this._xLabel);\r\n\t},\r\n\r\n\t_appendXGrid: function(grid) {\r\n\t\tgrid.append(\"g\")\r\n\t\t\t.attr(\"class\", \"x grid\")\r\n\t\t\t.attr(\"transform\", \"translate(0,\" + this._height() + \")\")\r\n\t\t\t.call(\r\n\t\t\t\td3\r\n\t\t\t\t.axisBottom()\r\n\t\t\t\t.scale(this._x)\r\n\t\t\t\t.ticks(this.options.xTicks)\r\n\t\t\t\t.tickSize(-this._height())\r\n\t\t\t\t.tickFormat(\"\")\r\n\t\t\t);\r\n\r\n\t},\r\n\r\n\t_appendYaxis: function(axis) {\r\n\t\taxis\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"class\", \"y axis\")\r\n\t\t\t.call(\r\n\t\t\t\td3\r\n\t\t\t\t.axisLeft()\r\n\t\t\t\t.scale(this._y)\r\n\t\t\t\t.ticks(this.options.yTicks)\r\n\t\t\t)\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"x\", -30)\r\n\t\t\t.attr(\"y\", 3)\r\n\t\t\t.text(this._yLabel);\r\n\t},\r\n\r\n\t_appendYGrid: function(grid) {\r\n\t\tgrid.append(\"g\")\r\n\t\t\t.attr(\"class\", \"y grid\")\r\n\t\t\t.call(\r\n\t\t\t\td3\r\n\t\t\t\t.axisLeft()\r\n\t\t\t\t.scale(this._y)\r\n\t\t\t\t.ticks(this.options.yTicks)\r\n\t\t\t\t.tickSize(-this._width())\r\n\t\t\t\t.tickFormat(\"\")\r\n\t\t\t);\r\n\t},\r\n\r\n\t_appendAreaPath: function(g) {\r\n\t\tthis._areapath = g.append(\"path\")\r\n\t\t\t.attr(\"class\", \"area\");\r\n\t},\r\n\r\n\t_appendAxis: function(g) {\r\n\t\tthis._axis = g.append(\"g\")\r\n\t\t\t.attr(\"class\", \"axis\");\r\n\t\tthis._appendXaxis(this._axis);\r\n\t\tthis._appendYaxis(this._axis);\r\n\t},\r\n\r\n\t_appendFocusRect: function(g) {\r\n\t\tvar focusRect = this._focusRect = g.append(\"rect\")\r\n\t\t\t.attr(\"width\", this._width())\r\n\t\t\t.attr(\"height\", this._height())\r\n\t\t\t.style(\"fill\", \"none\")\r\n\t\t\t.style(\"stroke\", \"none\")\r\n\t\t\t.style(\"pointer-events\", \"all\");\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\tfocusRect\r\n\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\r\n\t\t\tL.DomEvent.on(this._container, 'touchend', this._dragEndHandler, this);\r\n\t\t}\r\n\r\n\t\tfocusRect\r\n\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\r\n\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\r\n\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\r\n\t\tL.DomEvent.on(this._container, 'mouseup', this._dragEndHandler, this);\r\n\t},\r\n\r\n\t_appendGrid: function(g) {\r\n\t\tthis._grid = g.append(\"g\")\r\n\t\t\t.attr(\"class\", \"grid\");\r\n\t\tthis._appendXGrid(this._grid);\r\n\t\tthis._appendYGrid(this._grid);\r\n\t},\r\n\r\n\t_appendMouseFocusG: function(g) {\r\n\t\tvar focusG = this._focusG = g.append(\"g\")\r\n\t\t\t.attr(\"class\", \"mouse-focus-group\");\r\n\r\n\t\tthis._mousefocus = focusG.append('svg:line')\r\n\t\t\t.attr('class', 'mouse-focus-line')\r\n\t\t\t.attr('x2', '0')\r\n\t\t\t.attr('y2', '0')\r\n\t\t\t.attr('x1', '0')\r\n\t\t\t.attr('y1', '0');\r\n\r\n\t\tthis._focuslabelrect = focusG.append(\"rect\")\r\n\t\t\t.attr('class', 'mouse-focus-label')\r\n\t\t\t.attr(\"x\", 0)\r\n\t\t\t.attr(\"y\", 0)\r\n\t\t\t.attr(\"width\", 0)\r\n\t\t\t.attr(\"height\", 0)\r\n\t\t\t.attr(\"rx\", 3)\r\n\t\t\t.attr(\"ry\", 3);\r\n\r\n\t\tthis._focuslabeltext = focusG.append(\"svg:text\")\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\");\r\n\t\tthis._focuslabelY = this._focuslabeltext.append(\"svg:tspan\")\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\r\n\t\t\t.attr(\"dy\", \"-1em\");\r\n\t\tthis._focuslabelX = this._focuslabeltext.append(\"svg:tspan\")\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\r\n\t\t\t.attr(\"dy\", \"2em\");\r\n\t},\r\n\r\n\t_appendLegend: function(g) {\r\n\t\tif (!this.options.legend) return;\r\n\r\n\t\tvar legend = this._legend = g.append('g')\r\n\t\t\t.attr(\"class\", \"legend\");\r\n\r\n\t\tvar altitude = this._altitudeLegend = this._legend.append('g')\r\n\t\t\t.attr(\"class\", \"legend-altitude\");\r\n\r\n\t\taltitude.append(\"rect\")\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.attr(\"x\", (this._width() / 2) - 50)\r\n\t\t\t.attr(\"y\", this._height() + this.options.margins.bottom - 17)\r\n\t\t\t.attr(\"width\", 50)\r\n\t\t\t.attr(\"height\", 5)\r\n\t\t\t.attr(\"opacity\", 0.75);\r\n\r\n\t\taltitude.append('text')\r\n\t\t\t.text('Altitude')\r\n\t\t\t.attr(\"x\", (this._width() / 2) + 5)\r\n\t\t\t.attr(\"font-size\", 10)\r\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr('y', this._height() + this.options.margins.bottom - 11);\r\n\r\n\t},\r\n\r\n\t_appendPositionMarker: function(pane) {\r\n\t\tvar theme = this.options.theme;\r\n\t\tvar heightG = pane.select(\"g\");\r\n\r\n\t\tthis._mouseHeightFocus = heightG.append('svg:line')\r\n\t\t\t.attr(\"class\", theme + \" height-focus line\")\r\n\t\t\t.attr(\"x2\", 0)\r\n\t\t\t.attr(\"y2\", 0)\r\n\t\t\t.attr(\"x1\", 0)\r\n\t\t\t.attr(\"y1\", 0);\r\n\r\n\t\tthis._pointG = heightG.append(\"g\");\r\n\t\tthis._pointG.append(\"svg:circle\")\r\n\t\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\r\n\t\t\t.attr(\"r\", 6)\r\n\t\t\t.attr(\"cx\", 0)\r\n\t\t\t.attr(\"cy\", 0);\r\n\r\n\t\tthis._mouseHeightFocusLabel = heightG.append(\"svg:text\")\r\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\r\n\t\t\t.style(\"pointer-events\", \"none\");\r\n\t},\r\n\r\n\t_applyData: function() {\r\n\t\tif (!this._data) return;\r\n\r\n\t\tvar xdomain = d3.extent(this._data, function(d) {\r\n\t\t\treturn d.dist;\r\n\t\t});\r\n\t\tvar ydomain = d3.extent(this._data, function(d) {\r\n\t\t\treturn d.z;\r\n\t\t});\r\n\t\tvar opts = this.options;\r\n\r\n\t\tif (opts.yAxisMin !== undefined && (opts.yAxisMin < ydomain[0] || opts.forceAxisBounds)) {\r\n\t\t\tydomain[0] = opts.yAxisMin;\r\n\t\t}\r\n\t\tif (opts.yAxisMax !== undefined && (opts.yAxisMax > ydomain[1] || opts.forceAxisBounds)) {\r\n\t\t\tydomain[1] = opts.yAxisMax;\r\n\t\t}\r\n\r\n\t\tthis._x.domain(xdomain);\r\n\t\tthis._y.domain(ydomain);\r\n\t\tthis._areapath.datum(this._data)\r\n\t\t\t.attr(\"d\", this._area);\r\n\t\tthis._updateAxis();\r\n\r\n\t\tthis._fullExtent = this._calculateFullExtent(this._data);\r\n\t},\r\n\r\n\t/*\r\n\t * Calculates the full extent of the data array\r\n\t */\r\n\t_calculateFullExtent: function(data) {\r\n\t\tif (!data || data.length < 1) {\r\n\t\t\tthrow new Error(\"no data in parameters\");\r\n\t\t}\r\n\r\n\t\tvar ext = new L.latLngBounds(data[0].latlng, data[0].latlng);\r\n\r\n\t\tdata.forEach(function(item) {\r\n\t\t\text.extend(item.latlng);\r\n\t\t});\r\n\r\n\t\treturn ext;\r\n\t},\r\n\r\n\t_clearChart: function() {\r\n\t\tthis._resetDrag();\r\n\t\tif (this._areapath) {\r\n\t\t\t// workaround for 'Error: Problem parsing d=\"\"' in Webkit when empty data\r\n\t\t\t// https://groups.google.com/d/msg/d3-js/7rFxpXKXFhI/HzIO_NPeDuMJ\r\n\t\t\t//this._areapath.datum(this._data).attr(\"d\", this._area);\r\n\t\t\tthis._areapath.attr(\"d\", \"M0 0\");\r\n\r\n\t\t\tthis._x.domain([0, 1]);\r\n\t\t\tthis._y.domain([0, 1]);\r\n\t\t\tthis._updateAxis();\r\n\t\t}\r\n\t\tif (this._altitudeLegend) {\r\n\t\t\tthis._altitudeLegend.select('text').style(\"text-decoration-line\", \"line-through\");\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data\r\n\t */\r\n\t_clearData: function() {\r\n\t\tthis._data = null;\r\n\t\tthis._distance = null;\r\n\t\tthis._maxElevation = null;\r\n\t\tthis._minElevation = null;\r\n\t\tthis.track_info = null;\r\n\t\tthis._layers = null;\r\n\t\t// if (this.layer) {\r\n\t\t// \tthis.layer.removeFrom(this._map);\r\n\t\t// }\r\n\t},\r\n\r\n\t_clearPath: function() {\r\n\t\tthis._hidePositionMarker();\r\n\t\tfor (var id in this._layers) {\r\n\t\t\tL.DomUtil.removeClass(this._layers[id]._path, \"elevation-polyline\");\r\n\t\t\tL.DomUtil.removeClass(this._layers[id]._path, this.options.theme);\r\n\t\t}\r\n\t},\r\n\r\n\t_collapse: function() {\r\n\t\tif (this._container) {\r\n\t\t\tL.DomUtil.removeClass(this._container, 'elevation-expanded');\r\n\t\t\tL.DomUtil.addClass(this._container, 'elevation-collapsed');\r\n\t\t}\r\n\t},\r\n\r\n\t_deepMerge: function(target, ...sources) {\r\n\t\tif (!sources.length) return target;\r\n\t\tconst source = sources.shift();\r\n\t\tif (this._isObject(target) && this._isObject(source)) {\r\n\t\t\tfor (const key in source) {\r\n\t\t\t\tif (this._isObject(source[key])) {\r\n\t\t\t\t\tif (!target[key]) Object.assign(target, {\r\n\t\t\t\t\t\t[key]: {}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis._deepMerge(target[key], source[key]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tObject.assign(target, {\r\n\t\t\t\t\t\t[key]: source[key]\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._deepMerge(target, ...sources);\r\n\t},\r\n\r\n\t_saveFile: function(fileUrl) {\r\n\t\tvar d = document,\r\n\t\t\ta = d.createElement('a'),\r\n\t\t\tb = d.body;\r\n\t\ta.href = fileUrl;\r\n\t\ta.target = '_new';\r\n\t\ta.download = \"\"; // fileName\r\n\t\ta.style.display = 'none';\r\n\t\tb.appendChild(a);\r\n\t\ta.click();\r\n\t\tb.removeChild(a);\r\n\t},\r\n\r\n\t_dragHandler: function() {\r\n\t\t//we don't want map events to occur here\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = true;\r\n\t\tthis._drawDragRectangle();\r\n\t},\r\n\r\n\t/*\r\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\r\n\t */\r\n\t_dragEndHandler: function() {\r\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\r\n\t\t\tthis._dragStartCoords = null;\r\n\t\t\tthis._gotDragged = false;\r\n\t\t\tif (this._draggingEnabled) this._resetDrag();\r\n\t\t\t// autotoggle chart data on single click\r\n\t\t\tif (this.options.legend && this._chartEnabled) {\r\n\t\t\t\tthis._clearChart();\r\n\t\t\t\tthis._clearPath();\r\n\t\t\t\tthis._chartEnabled = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis._resizeChart();\r\n\t\t\t\tthis._chartEnabled = true;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar item1 = this._findItemForX(this._dragStartCoords[0]),\r\n\t\t\titem2 = this._findItemForX(this._dragCurrentCoords[0]);\r\n\r\n\t\tif (item1 == item2) return;\r\n\r\n\t\tthis._hidePositionMarker();\r\n\r\n\t\tthis._fitSection(item1, item2);\r\n\r\n\t\tthis._dragStartCoords = null;\r\n\t\tthis._gotDragged = false;\r\n\r\n\t\tvar evt = {\r\n\t\t\tdata: {\r\n\t\t\t\tdragstart: this._data[item1],\r\n\t\t\t\tdragend: this._data[item2]\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (this.fire) this.fire(\"elechart_dragged\", evt, true);\r\n\t\tif (this._map) this._map.fire(\"elechart_dragged\", evt, true);\r\n\t},\r\n\r\n\t_dragStartHandler: function() {\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = false;\r\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\r\n\t},\r\n\r\n\t/*\r\n\t * Draws the currently dragged rectangle over the chart.\r\n\t */\r\n\t_drawDragRectangle: function() {\r\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar dragEndCoords = this._dragCurrentCoords = d3.mouse(this._focusRect.node());\r\n\r\n\t\tvar x1 = Math.min(this._dragStartCoords[0], dragEndCoords[0]),\r\n\t\t\tx2 = Math.max(this._dragStartCoords[0], dragEndCoords[0]);\r\n\r\n\t\tif (!this._dragRectangle && !this._dragRectangleG) {\r\n\t\t\tvar g = d3.select(this._container).select(\"svg\").select(\"g\");\r\n\r\n\t\t\tthis._dragRectangleG = g.insert(\"g\", \".mouse-focus-group\");\r\n\r\n\t\t\tthis._dragRectangle = this._dragRectangleG.append(\"rect\")\r\n\t\t\t\t.attr(\"width\", x2 - x1)\r\n\t\t\t\t.attr(\"height\", this._height())\r\n\t\t\t\t.attr(\"x\", x1)\r\n\t\t\t\t.attr('class', 'mouse-drag')\r\n\t\t\t\t.style(\"pointer-events\", \"none\");\r\n\t\t} else {\r\n\t\t\tthis._dragRectangle.attr(\"width\", x2 - x1)\r\n\t\t\t\t.attr(\"x\", x1);\r\n\t\t}\r\n\t},\r\n\r\n\t_expand: function() {\r\n\t\tif (this._container) {\r\n\t\t\tL.DomUtil.removeClass(this._container, 'elevation-collapsed');\r\n\t\t\tL.DomUtil.addClass(this._container, 'elevation-expanded');\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Finds an item with the smallest delta in distance to the given latlng coords\r\n\t */\r\n\t_findItemForLatLng: function(latlng) {\r\n\t\tvar result = null,\r\n\t\t\td = Infinity;\r\n\t\tthis._data.forEach(function(item) {\r\n\t\t\tvar dist = latlng.distanceTo(item.latlng);\r\n\t\t\tif (dist < d) {\r\n\t\t\t\td = dist;\r\n\t\t\t\tresult = item;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\tvar bisect = d3.bisector(function(d) {\r\n\t\t\treturn d.dist;\r\n\t\t}).left;\r\n\t\tvar xinvert = this._x.invert(x);\r\n\t\treturn bisect(this._data, xinvert);\r\n\t},\r\n\r\n\t/**\r\n\t * Make the map fit the route section between given indexes.\r\n\t */\r\n\t_fitSection: function(index1, index2) {\r\n\t\tvar start = Math.min(index1, index2);\r\n\t\tvar end = Math.max(index1, index2);\r\n\t\tvar ext = this._calculateFullExtent(this._data.slice(start, end));\r\n\t\tthis.fitBounds(ext);\r\n\t},\r\n\r\n\t/*\r\n\t * Fromatting funciton using the given decimals and seperator\r\n\t */\r\n\t_formatter: function(num, dec, sep) {\r\n\t\tvar res;\r\n\t\tif (dec === 0) {\r\n\t\t\tres = Math.round(num) + \"\";\r\n\t\t} else {\r\n\t\t\tres = L.Util.formatNum(num, dec) + \"\";\r\n\t\t}\r\n\t\tvar numbers = res.split(\".\");\r\n\t\tif (numbers[1]) {\r\n\t\t\tvar d = dec - numbers[1].length;\r\n\t\t\tfor (; d > 0; d--) {\r\n\t\t\t\tnumbers[1] += \"0\";\r\n\t\t\t}\r\n\t\t\tres = numbers.join(sep || \".\");\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_height: function() {\r\n\t\tvar opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_hidePositionMarker: function() {\r\n\t\tif (!this.options.autohideMarker) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._selectedItem = null;\r\n\r\n\t\tif (this._marker) {\r\n\t\t\tif (this._map) this._map.removeLayer(this._marker);\r\n\t\t\tthis._marker = null;\r\n\t\t}\r\n\t\tif (this._mouseHeightFocus) {\r\n\t\t\tthis._mouseHeightFocus.style(\"visibility\", \"hidden\");\r\n\t\t\tthis._mouseHeightFocusLabel.style(\"visibility\", \"hidden\");\r\n\t\t}\r\n\t\tif (this._pointG) {\r\n\t\t\tthis._pointG.style(\"visibility\", \"hidden\");\r\n\t\t}\r\n\t\tif (this._focusG) {\r\n\t\t\tthis._focusG.style(\"visibility\", \"hidden\");\r\n\t\t}\r\n\t},\r\n\r\n\t_initChart: function() {\r\n\t\tvar opts = this.options;\r\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\r\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\r\n\t\topts.hoverNumber.formatter = opts.hoverNumber.formatter || this._formatter;\r\n\r\n\t\tif (opts.responsive) {\r\n\t\t\tif (opts.detached) {\r\n\t\t\t\tvar offWi = this.eleDiv.offsetWidth;\r\n\t\t\t\tvar offHe = this.eleDiv.offsetHeight;\r\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\r\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\r\n\t\t\t} else {\r\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\r\n\t\t\t\tvar containerWidth = this._map._container.clientWidth;\r\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar x = this._x = d3.scaleLinear().range([0, this._width()]);\r\n\t\tvar y = this._y = d3.scaleLinear().range([this._height(), 0]);\r\n\r\n\t\tvar interpolation = typeof opts.interpolation === 'function' ? opts.interpolation : d3[opts.interpolation];\r\n\r\n\t\tvar area = this._area = d3.area().curve(interpolation)\r\n\t\t\t.x(function(d) {\r\n\t\t\t\treturn (d.xDiagCoord = x(d.dist));\r\n\t\t\t})\r\n\t\t\t.y0(this._height())\r\n\t\t\t.y1(function(d) {\r\n\t\t\t\treturn y(d.z);\r\n\t\t\t});\r\n\t\tvar line = this._line = d3.line()\r\n\t\t\t.x(function(d) {\r\n\t\t\t\treturn d3.mouse(svg.select(\"g\"))[0];\r\n\t\t\t})\r\n\t\t\t.y(function(d) {\r\n\t\t\t\treturn this._height();\r\n\t\t\t});\r\n\r\n\t\tvar container = d3.select(this._container);\r\n\r\n\t\tvar svg = container.append(\"svg\")\r\n\t\t\t.attr(\"class\", \"background\")\r\n\t\t\t.attr(\"width\", opts.width)\r\n\t\t\t.attr(\"height\", opts.height);\r\n\r\n\t\tvar summary = this.summaryDiv = container.append(\"div\")\r\n\t\t\t.attr(\"class\", \"elevation-summary \" + this.options.summary + \"-summary\").node();\r\n\r\n\t\tthis._appendChart(svg);\r\n\t\tthis._updateSummary();\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * Inspired by L.Control.Layers\r\n\t */\r\n\t_initToggle: function(container) {\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container);\r\n\t\t\t//.disableScrollPropagation(container);\r\n\t\t}\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\tL.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\tL.DomEvent.on(container, 'mousewheel', this._mousewheelHandler, this);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tvar iconCssClass = \"elevation-toggle \" + this.options.controlButton.iconCssClass + (this.options.autohide ? \"\" : \" close-button\");\r\n\t\t\tvar link = this._button = L.DomUtil.create('a', iconCssClass, container);\r\n\t\t\tlink.href = '#';\r\n\t\t\tlink.title = this.options.controlButton.title;\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t\tif (this.options.autohide) {\r\n\t\t\t\t\tL.DomEvent\r\n\t\t\t\t\t\t.on(container, 'mouseover', this._expand, this)\r\n\t\t\t\t\t\t.on(container, 'mouseout', this._collapse, this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tL.DomEvent\r\n\t\t\t\t\t\t.on(link, 'click', L.DomEvent.stop)\r\n\t\t\t\t\t\t.on(link, 'click', this._toggle, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tL.DomEvent.on(link, 'focus', this._toggle, this);\r\n\r\n\t\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t\t// TODO: keyboard accessibility\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// TODO: handle autohide when detached=true\r\n\t\t}\r\n\t},\r\n\r\n\t_isObject: function(item) {\r\n\t\treturn (item && typeof item === 'object' && !Array.isArray(item));\r\n\t},\r\n\r\n\t_isJSONDoc: function(doc, lazy) {\r\n\t\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\t\tif (typeof doc === \"string\" && lazy) {\r\n\t\t\tdoc = doc.trim();\r\n\t\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tJSON.parse(doc.toString());\r\n\t\t\t} catch (e) {\r\n\t\t\t\tif (typeof doc === \"object\" && lazy) return true;\r\n\t\t\t\tconsole.warn(e);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\t_isXMLDoc: function(doc, lazy) {\r\n\t\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\t\tif (typeof doc === \"string\" && lazy) {\r\n\t\t\tdoc = doc.trim();\r\n\t\t\treturn doc.indexOf(\"<\") == 0;\r\n\t\t} else {\r\n\t\t\tvar documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\r\n\t\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n\t\t}\r\n\t},\r\n\r\n\t_isDomVisible: function(elem) {\r\n\t\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\r\n\t},\r\n\r\n\t_isVisible: function(elem) {\r\n\t\tif (!elem) return false;\r\n\r\n\t\tlet styles = window.getComputedStyle(elem);\r\n\r\n\t\tfunction isVisibleByStyles(elem, styles) {\r\n\t\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\r\n\t\t}\r\n\r\n\t\tfunction isAboveOtherElements(elem, styles) {\r\n\t\t\tlet boundingRect = elem.getBoundingClientRect();\r\n\t\t\tlet left = boundingRect.left + 1;\r\n\t\t\tlet right = boundingRect.right - 1;\r\n\t\t\tlet top = boundingRect.top + 1;\r\n\t\t\tlet bottom = boundingRect.bottom - 1;\r\n\t\t\tlet above = true;\r\n\r\n\t\t\tlet pointerEvents = elem.style.pointerEvents;\r\n\r\n\t\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\r\n\r\n\t\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\r\n\t\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\r\n\r\n\t\t\t// Only for completely visible elements\r\n\t\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\r\n\t\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\r\n\r\n\t\t\telem.style.pointerEvents = pointerEvents;\r\n\r\n\t\t\treturn above;\r\n\t\t}\r\n\r\n\t\tif (!isVisibleByStyles(elem, styles)) return false;\r\n\t\tif (!isAboveOtherElements(elem, styles)) return false;\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_lazyLoadJS: function(url, skip) {\r\n\t\tif (typeof skip == \"undefined\") {\r\n\t\t\tskip = false;\r\n\t\t}\r\n\t\tif (skip instanceof Promise) {\r\n\t\t\treturn skip;\r\n\t\t}\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\tif (skip) return resolve();\r\n\t\t\tvar tag = document.createElement(\"script\");\r\n\t\t\ttag.addEventListener('load', resolve, { once: true });\r\n\t\t\ttag.src = url;\r\n\t\t\tdocument.head.appendChild(tag);\r\n\t\t});\r\n\t},\r\n\r\n\t_mouseenterHandler: function() {\r\n\t\tif (this.fire) {\r\n\t\t\tthis.fire(\"elechart_enter\", null, true);\r\n\t\t}\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.fire(\"elechart_enter\", null, true);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level\r\n\t */\r\n\t_mousemoveHandler: function(d, i, ctx) {\r\n\t\tif (!this._data || this._data.length === 0 || !this._chartEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar coords = d3.mouse(this._focusRect.node());\r\n\t\tvar xCoord = coords[0];\r\n\t\tvar item = this._data[this._findItemForX(xCoord)];\r\n\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis._showDiagramIndicator(item, xCoord);\r\n\t\tthis._showPositionMarker(item);\r\n\t\tthis._setMapView(item);\r\n\r\n\t\tif (this._map && this._map._container) {\r\n\t\t\tL.DomUtil.addClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tvar evt = {\r\n\t\t\tdata: item\r\n\t\t};\r\n\t\tif (this.fire) {\r\n\t\t\tthis.fire(\"elechart_change\", evt, true);\r\n\t\t\tthis.fire(\"elechart_hover\", evt, true);\r\n\t\t}\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.fire(\"elechart_change\", evt, true);\r\n\t\t\tthis._map.fire(\"elechart_hover\", evt, true);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles mouseover events of the data layers on the map.\r\n\t */\r\n\t_mousemoveLayerHandler: function(e) {\r\n\t\tif (!this._data || this._data.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar latlng = e.latlng;\r\n\t\tvar item = this._findItemForLatLng(latlng);\r\n\t\tif (item) {\r\n\t\t\tvar xCoord = item.xDiagCoord;\r\n\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t\tthis._showDiagramIndicator(item, xCoord);\r\n\t\t\tthis._showPositionMarker(item);\r\n\t\t}\r\n\t},\r\n\r\n\t_mouseoutHandler: function() {\r\n\t\tif (!this.options.detached) {\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t}\r\n\r\n\t\tif (this._map && this._map._container) {\r\n\t\t\tL.DomUtil.removeClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tif (this.fire) this.fire(\"elechart_leave\", null, true);\r\n\t\tif (this._map) this._map.fire(\"elechart_leave\", null, true);\r\n\t},\r\n\r\n\t_mousewheelHandler: function(e) {\r\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\r\n\t\tvar ll = this._selectedItem ? this._selectedItem.latlng : this._map.getCenter();\r\n\t\tvar z = e.deltaY > 0 ? this._map.getZoom() - 1 : this._map.getZoom() + 1;\r\n\t\tthis._resetDrag();\r\n\t\tthis._map.flyTo(ll, z);\r\n\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tif (this._dragRectangleG) {\r\n\t\t\tthis._dragRectangleG.remove();\r\n\t\t\tthis._dragRectangleG = null;\r\n\t\t\tthis._dragRectangle = null;\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t}\r\n\t},\r\n\r\n\t_resetView: function() {\r\n\t\tif (this._map && this._map._isFullscreen) return;\r\n\t\tthis._resetDrag();\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis.fitBounds(this._fullExtent);\r\n\t},\r\n\r\n\t_resizeChart: function() {\r\n\t\tif (this.options.responsive) {\r\n\t\t\tif (this.options.detached) {\r\n\t\t\t\tvar newWidth = this.eleDiv.offsetWidth; // - 20;\r\n\r\n\t\t\t\tif (newWidth <= 0) return;\r\n\r\n\t\t\t\tthis.options.width = newWidth;\r\n\t\t\t\tthis.eleDiv.innerHTML = \"\";\r\n\t\t\t\tthis.eleDiv.appendChild(this.onAdd(this._map));\r\n\t\t\t} else {\r\n\t\t\t\tthis._map.removeControl(this._container);\r\n\t\t\t\tthis.addTo(this._map);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_showDiagramIndicator: function(item, xCoordinate) {\r\n\t\tif (!this._chartEnabled) return;\r\n\r\n\t\tvar opts = this.options;\r\n\t\tthis._focusG.style(\"visibility\", \"visible\");\r\n\r\n\t\tthis._mousefocus.attr('x1', xCoordinate)\r\n\t\t\t.attr('y1', 0)\r\n\t\t\t.attr('x2', xCoordinate)\r\n\t\t\t.attr('y2', this._height())\r\n\t\t\t.classed('hidden', false);\r\n\r\n\t\tvar alt = item.z,\r\n\t\t\tdist = item.dist,\r\n\t\t\tll = item.latlng,\r\n\t\t\tnumY = opts.hoverNumber.formatter(alt, opts.hoverNumber.decimalsY),\r\n\t\t\tnumX = opts.hoverNumber.formatter(dist, opts.hoverNumber.decimalsX);\r\n\r\n\t\tthis._focuslabeltext\r\n\t\t\t// .attr(\"x\", xCoordinate)\r\n\t\t\t.attr(\"y\", this._y(item.z))\r\n\t\t\t.style(\"font-weight\", \"700\");\r\n\r\n\t\tthis._focuslabelX\r\n\t\t\t.text(numX + \" \" + this._xLabel)\r\n\t\t\t.attr(\"x\", xCoordinate + 10);\r\n\r\n\t\tthis._focuslabelY\r\n\t\t\t.text(numY + \" \" + this._yLabel)\r\n\t\t\t.attr(\"x\", xCoordinate + 10);\r\n\r\n\t\tvar focuslabeltext = this._focuslabeltext.node();\r\n\t\tif (this._isDomVisible(focuslabeltext)) {\r\n\t\t\tvar bbox = focuslabeltext.getBBox();\r\n\t\t\tvar padding = 2;\r\n\r\n\t\t\tthis._focuslabelrect\r\n\t\t\t\t.attr(\"x\", bbox.x - padding)\r\n\t\t\t\t.attr(\"y\", bbox.y - padding)\r\n\t\t\t\t.attr(\"width\", bbox.width + (padding * 2))\r\n\t\t\t\t.attr(\"height\", bbox.height + (padding * 2));\r\n\r\n\t\t\t// move focus label to left\r\n\t\t\tif (xCoordinate >= this._width() / 2) {\r\n\t\t\t\tthis._focuslabelrect.attr(\"x\", this._focuslabelrect.attr(\"x\") - this._focuslabelrect.attr(\"width\") - (padding * 2) - 10);\r\n\t\t\t\tthis._focuslabelX.attr(\"x\", this._focuslabelX.attr(\"x\") - this._focuslabelrect.attr(\"width\") - (padding * 2) - 10);\r\n\t\t\t\tthis._focuslabelY.attr(\"x\", this._focuslabelY.attr(\"x\") - this._focuslabelrect.attr(\"width\") - (padding * 2) - 10);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_toggle: function() {\r\n\t\tif (L.DomUtil.hasClass(this._container, \"elevation-expanded\"))\r\n\t\t\tthis._collapse();\r\n\t\telse\r\n\t\t\tthis._expand();\r\n\t},\r\n\r\n\t_setMapView: function(item) {\r\n\t\tif (!this.options.followMarker || !this._map) return;\r\n\t\tvar zoom = this._map.getZoom();\r\n\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\r\n\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\r\n\t},\r\n\r\n\t_showPositionMarker: function(item) {\r\n\t\tthis._selectedItem = item;\r\n\r\n\t\tif (this._map && !this._map.getPane('elevationPane')) {\r\n\t\t\tthis._map.createPane('elevationPane');\r\n\t\t\tthis._map.getPane('elevationPane').style.zIndex = 625; // This pane is above markers but below popups.\r\n\t\t\tthis._map.getPane('elevationPane').style.pointerEvents = 'none';\r\n\t\t}\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tthis._updatePositionMarker(item);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._updateLeafletMarker(item);\r\n\t\t}\r\n\t},\r\n\r\n\t_updateAxis: function() {\r\n\t\tthis._grid.selectAll(\"g\").remove();\r\n\t\tthis._axis.selectAll(\"g\").remove();\r\n\t\tthis._appendXGrid(this._grid);\r\n\t\tthis._appendYGrid(this._grid);\r\n\t\tthis._appendXaxis(this._axis);\r\n\t\tthis._appendYaxis(this._axis);\r\n\t},\r\n\r\n\t_updateHeightIndicator: function(item) {\r\n\t\tvar opts = this.options;\r\n\r\n\t\tvar numY = opts.hoverNumber.formatter(item.z, opts.hoverNumber.decimalsY),\r\n\t\t\tnumX = opts.hoverNumber.formatter(item.dist, opts.hoverNumber.decimalsX);\r\n\r\n\t\tvar normalizedAlt = this._height() / this._maxElevation * item.z,\r\n\t\t\tnormalizedY = item.y - normalizedAlt;\r\n\r\n\t\tthis._mouseHeightFocus\r\n\t\t\t.attr(\"x1\", item.x)\r\n\t\t\t.attr(\"x2\", item.x)\r\n\t\t\t.attr(\"y1\", item.y)\r\n\t\t\t.attr(\"y2\", normalizedY)\r\n\t\t\t.style(\"visibility\", \"visible\");\r\n\r\n\t\tthis._mouseHeightFocusLabel\r\n\t\t\t.attr(\"x\", item.x)\r\n\t\t\t.attr(\"y\", normalizedY)\r\n\t\t\t.text(numY + \" \" + this._yLabel)\r\n\t\t\t.style(\"visibility\", \"visible\");\r\n\t},\r\n\r\n\t_updateLeafletMarker: function(item) {\r\n\t\tvar ll = item.latlng;\r\n\r\n\t\tif (!this._marker) {\r\n\t\t\tthis._marker = new L.Marker(ll, {\r\n\t\t\t\ticon: this.options.markerIcon,\r\n\t\t\t\tzIndexOffset: 1000000,\r\n\t\t\t});\r\n\t\t\tthis._marker.addTo(this._map, {\r\n\t\t\t\tpane: 'elevationPane',\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis._marker.setLatLng(ll);\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePointG: function(item) {\r\n\t\tthis._pointG\r\n\t\t\t.attr(\"transform\", \"translate(\" + item.x + \",\" + item.y + \")\")\r\n\t\t\t.style(\"visibility\", \"visible\");\r\n\t},\r\n\r\n\t_updatePositionMarker: function(item) {\r\n\t\tvar point = this._map.latLngToLayerPoint(item.latlng);\r\n\t\tvar layerpoint = {\r\n\t\t\tdist: item.dist,\r\n\t\t\tx: point.x,\r\n\t\t\ty: point.y,\r\n\t\t\tz: item.z,\r\n\t\t};\r\n\r\n\t\tif (!this._mouseHeightFocus) {\r\n\t\t\tL.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\r\n\t\t\tvar layerpane = d3.select(this._map.getContainer()).select(\".leaflet-elevation-pane svg\");\r\n\t\t\tthis._appendPositionMarker(layerpane);\r\n\t\t}\r\n\r\n\t\tthis._updatePointG(layerpoint);\r\n\t\tthis._updateHeightIndicator(layerpoint);\r\n\t},\r\n\r\n\t_updateSummary: function() {\r\n\t\tif (this.options.summary && this.summaryDiv) {\r\n\t\t\tthis.track_info = this.track_info || {};\r\n\t\t\tthis.track_info.distance = this._distance || 0;\r\n\t\t\tthis.track_info.elevation_max = this._maxElevation || 0;\r\n\t\t\tthis.track_info.elevation_min = this._minElevation || 0;\r\n\t\t\td3.select(this.summaryDiv).html('<span class=\"totlen\"><span class=\"summarylabel\">' + L._(\"Total Length: \") + '</span><span class=\"summaryvalue\">' + this.track_info.distance.toFixed(2) + ' ' + this._xLabel + '</span></span><span class=\"maxele\"><span class=\"summarylabel\">' + L._(\"Max Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_max.toFixed(2) + ' ' + this._yLabel + '</span></span><span class=\"minele\"><span class=\"summarylabel\">' + L._(\"Min Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_min.toFixed(2) + ' ' + this._yLabel + '</span></span>');\r\n\t\t}\r\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\r\n\t\t\tvar span = document.createElement('span');\r\n\t\t\tspan.className = 'download';\r\n\t\t\tvar save = document.createElement('a');\r\n\t\t\tsave.innerHTML = \"Download\";\r\n\t\t\tsave.href = \"#\";\r\n\t\t\tsave.onclick = function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar evt = { confirm: this._saveFile.bind(this, this._downloadURL) };\r\n\t\t\t\tvar type = this.options.downloadLink;\r\n\t\t\t\tif (type == 'modal') {\r\n\t\t\t\t\tif (typeof CustomEvent === \"function\") document.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: evt }));\r\n\t\t\t\t\tif (this.fire) this.fire('eletrack_download', evt);\r\n\t\t\t\t\tif (this._map) this._map.fire('eletrack_download', evt);\r\n\t\t\t\t} else if (type == 'link' || type === true) {\r\n\t\t\t\t\tevt.confirm();\r\n\t\t\t\t}\r\n\t\t\t}.bind(this);\r\n\r\n\t\t\tthis.summaryDiv.appendChild(span).appendChild(save);\r\n\t\t}\r\n\t},\r\n\r\n\t_width: function() {\r\n\t\tvar opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n});\r\n\r\nL.control.elevation = function(options) {\r\n\treturn new L.Control.Elevation(options);\r\n};\r\n"],"names":["factory","window","define","amd","exports","module","require","L","locales","locale","registerLocale","code","Util","extend","setLocale","i18n","_","string","data","template","err","Control","Elevation","includes","Evented","prototype","Mixin","Events","options","autohide","autohideMarker","collapsed","controlButton","iconCssClass","title","detached","distanceFactor","downloadLink","elevationDiv","followMarker","forceAxisBounds","gpxOptions","async","marker_options","startIconUrl","endIconUrl","shadowUrl","wptIcons","divIcon","className","html","iconSize","iconAnchor","polyline_options","color","opacity","weight","lineCap","height","heightFactor","hoverNumber","decimalsX","decimalsY","formatter","undefined","imperial","interpolation","lazyLoadJS","legend","loadData","defer","lazy","marker","markerIcon","placeholder","position","reverseCoords","skipNullZCoords","theme","margins","top","right","bottom","left","responsive","summary","width","xLabel","xTicks","yAxisMax","yAxisMin","yLabel","yTicks","zFollow","__mileFactor","__footFactor","addData","d","layer","this","_addData","_container","_applyData","on","_path","DomUtil","addClass","_mousemoveLayerHandler","_mouseoutHandler","track_info","distance","_distance","elevation_max","_maxElevation","elevation_min","_minElevation","_layers","stamp","evt","fire","_map","addTo","map","_addToChartDiv","call","clear","_clearPath","_clearChart","_clearData","disableDragging","_draggingEnabled","_resetDrag","enableDragging","fitBounds","bounds","_fullExtent","getZFollow","_zFollow","hide","style","display","initialize","Browser","mobile","detachedView","responsiveView","showTrackInfo","summaryType","autohidePositionMarker","followPositionMarker","useLeafletMarker","leafletMarkerIcon","download","_deepMerge","_chartEnabled","_distanceFactor","_heightFactor","_xLabel","_yLabel","_setMapView","throttle","load","opts","loadChart","loadDefer","loadLazy","_isXMLDoc","loadGPX","_isJSONDoc","loadGeoJSON","loadFile","document","readyState","addEventListener","bind","once","url","_downloadURL","xhr","XMLHttpRequest","responseType","open","onload","status","response","send","e","console","warn","JSON","parse","geojson","geoJson","feature","onEachFeature","type","name","getBounds","callback","gpx","GPX","target","point","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","line","get_name","_gpxLazyLoader","_lazyLoadJS","then","ticking","scrollFn","requestAnimFrame","_isVisible","removeEventListener","parentNode","removeChild","onAdd","container","create","_data","src","alt","i","setAttribute","insertBefore","firstChild","_initToggle","_initChart","_hidePositionMarker","_resetView","_resizeChart","_updateSummary","DomEvent","d3","_d3LazyLoader","onRemove","redraw","setZFollow","zoom","show","geom","geometry","_addGeoJSONData","coordinates","length","features","_latlngs","_addGPXdata","coords","_addPoint","lat","lng","meta","ele","x","y","z","tmp","eleMax","Infinity","eleMin","dist","curr","LatLng","prev","latlng","delta","distanceTo","Math","round","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","push","_appendElevationDiv","appendChild","_appendChart","svg","g","append","attr","_appendGrid","_appendAreaPath","_appendAxis","_appendFocusRect","_appendMouseFocusG","_appendLegend","eleDiv","querySelector","random","toString","substr","id","nextSibling","removeClass","_appendXaxis","axis","_height","axisBottom","scale","_x","ticks","_width","text","_appendXGrid","grid","tickSize","tickFormat","_appendYaxis","axisLeft","_y","_appendYGrid","_areapath","_axis","focusRect","_focusRect","_dragHandler","_dragStartHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","_grid","focusG","_focusG","_mousefocus","_focuslabelrect","_focuslabeltext","_focuslabelY","_focuslabelX","_legend","altitude","_altitudeLegend","_appendPositionMarker","pane","heightG","select","_mouseHeightFocus","_pointG","_mouseHeightFocusLabel","xdomain","extent","ydomain","domain","datum","_area","_updateAxis","_calculateFullExtent","Error","ext","latLngBounds","forEach","item","_collapse","sources","source","shift","_isObject","key","Object","assign","[object Object]","_saveFile","fileUrl","a","createElement","b","body","href","click","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","_dragCurrentCoords","item1","_findItemForX","item2","_fitSection","dragstart","dragend","mouse","node","dragEndCoords","x1","min","x2","max","_dragRectangle","_dragRectangleG","insert","_expand","_findItemForLatLng","result","bisect","bisector","xinvert","invert","index1","index2","start","end","slice","_formatter","num","dec","sep","res","numbers","formatNum","split","join","_selectedItem","_marker","removeLayer","offWi","offsetWidth","offHe","offsetHeight","_maxWidth","containerWidth","clientWidth","scaleLinear","range","area","curve","xDiagCoord","y0","y1","_line","summaryDiv","disableClickPropagation","_mousewheelHandler","link","_button","stop","_toggle","Array","isArray","doc","trim","indexOf","documentElement","ownerDocument","nodeName","_isDomVisible","elem","getClientRects","styles","getComputedStyle","visibility","isVisibleByStyles","boundingRect","getBoundingClientRect","above","pointerEvents","elementFromPoint","isAboveOtherElements","skip","Promise","resolve","reject","tag","head","ctx","xCoord","_showDiagramIndicator","_showPositionMarker","gestureHandling","_enabled","ll","getCenter","deltaY","getZoom","flyTo","remove","_isFullscreen","newWidth","innerHTML","removeControl","xCoordinate","classed","numY","numX","focuslabeltext","bbox","getBBox","hasClass","setView","animate","duration","getPane","createPane","zIndex","_updatePositionMarker","_updateLeafletMarker","selectAll","_updateHeightIndicator","normalizedAlt","normalizedY","setLatLng","Marker","icon","zIndexOffset","_updatePointG","latLngToLayerPoint","layerpoint","layerpane","getContainer","toFixed","span","save","onclick","confirm","CustomEvent","dispatchEvent","detail","control","elevation"],"mappings":"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"}